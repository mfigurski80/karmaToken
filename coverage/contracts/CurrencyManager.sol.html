<!DOCTYPE html><html lang="en"><head>
    <title>Code coverage report for contracts/CurrencyManager.sol</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>.coverage-summary .sorter{background-image:url(../sort-arrow-sprite.png)}
</style>
</head>
<body>
<div class="wrapper">
  <div class="pad1">
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> CurrencyManager.sol
    </h1>
    <div class="clearfix">
      <div class="fl pad1y space-right2">
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class="fraction">0/28</span>
      </div>
      <div class="fl pad1y space-right2">
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class="fraction">0/18</span>
      </div>
      <div class="fl pad1y space-right2">
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class="fraction">0/7</span>
      </div>
      <div class="fl pad1y space-right2">
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class="fraction">0/23</span>
      </div>
    </div>
  </div>
  <div class="status-line low"></div>
<pre><table class="coverage">
<tbody><tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.0;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/token/ERC1155/IERC1155.sol";
&nbsp;
/// @notice Enum representing various supported currency types
enum CurrencyType {
    Ether,
    ERC20,
    ERC721,
    ERC1155Token,
    ERC1155NFT
}
&nbsp;
/// @notice Expanded Currency structure to be referenced by bonds
struct Currency {
    CurrencyType currencyType; // {ERC20, ERC721, ERC1155 tokens, ERC1155 NFTs} = {0,1,2,3}
    uint88 ERC1155SmallId;
    address location;
    uint256 ERC1155Id; // if ERC1155 and id &gt; 500 septillion, use extra slot
}
&nbsp;
/**
 * @title 💴 Currency contract that maintains an internal currency listings
 * @notice This listing is referred to in all future bonds and
 * collateral structures, used to figure out payment.
 */
contract CurrencyManager {
    // TODO: generic addCurrency?
&nbsp;
    /**
     * @notice Array holding currency listing.
     * @dev Note that position 0 will always be taken by the Ethereum
     * currency type, as ensured by the constructor.
     */
    Currency[] public currencies;
&nbsp;
    /// @notice New currency has been added to internal listing
    event CurrencyAdded(
        uint256 id,
        CurrencyType currencyType,
        address location,
        uint256 ERC1155Id
    );
&nbsp;
<span class="fstat-no" title="function not covered">    constructor() {</span>
<span class="cstat-no" title="statement not covered">        currencies.push(Currency(CurrencyType.Ether, 0, address(0), 0))</span>;
    }
&nbsp;
    /**
     * @notice Add a new currency of type ERC20
     * @param location address of the ERC20 contract being added
     */
<span class="fstat-no" title="function not covered">    function addERC20Currency(address location) public payable virtual {</span>
<span class="cstat-no" title="statement not covered">        _addCurrency(Currency(CurrencyType.ERC20, 0, location, 0))</span>;
    }
&nbsp;
    /**
     * @dev Add a new currency of type ERC721
     * @param location address of the ERC721 contract being added
     */
<span class="fstat-no" title="function not covered">    function addERC721Currency(address location) public payable virtual {</span>
<span class="cstat-no" title="statement not covered">        _addCurrency(Currency(CurrencyType.ERC721, 0, location, 0))</span>;
    }
&nbsp;
    /**
     * @notice Add a new currency of type ERC1155 Token
     * @param location address of the ERC1155 contract being added
     * @param tokenId specific tokenId to associate with this ERC1155
     * currency listing.
     * @dev TokenId is required because structures that reference
     * this currency are only able to specify one field -- the amount, and
     * so the tokenId must be constant and specified here
     */
<span class="fstat-no" title="function not covered">    function addERC1155TokenCurrency(address location, uint256 tokenId)</span>
        public
        payable
        virtual
    {
<span class="cstat-no" title="statement not covered">        Currency memory c = Currency(</span>
            CurrencyType.ERC1155Token,
            uint88(tokenId),
            location,
            0
        );
<span class="cstat-no" title="statement not covered">        if (c.ERC1155SmallId != tokenId) {</span>
<span class="cstat-no" title="statement not covered">            c.ERC1155Id = tokenId</span>;
        }
<span class="cstat-no" title="statement not covered">        _addCurrency(c)</span>;
    }
&nbsp;
    /**
     * @notice Add a new currency of type ERC1155 NFT.
     * @dev Note that no tokenId is required -- since we know the count to
     * be 1, the structures that reference this currency can use their
     * field to specify the tokenId.
     * @param location address of ERC1155 contract being added
     */
<span class="fstat-no" title="function not covered">    function addERC1155NFTCurrency(address location) public payable virtual {</span>
<span class="cstat-no" title="statement not covered">        _addCurrency(Currency(CurrencyType.ERC1155NFT, 0, location, 0))</span>;
    }
&nbsp;
    /**
     * @dev Safely tansfer any supported currency using its interface
     * @param cur Currency type to transfer
     * @param from Which address to transfer from
     * @param to Which address to transfer to
     * @param amountOrId Either amount or id.
     * @param data bytes to pass on with the transaction
     * @dev The amountOrId paramenter represents the missing integer
     * that Currency doesn't store itself -- in the case of a fungible
     * token, the amount, but in the case of an NFT, the token id.
     */
<span class="fstat-no" title="function not covered">    function _transferGenericCurrency(</span>
        Currency storage cur,
        address from,
        address to,
        uint256 amountOrId,
        bytes memory data
    ) internal returns (bool) {
<span class="cstat-no" title="statement not covered">        if (cur.currencyType == CurrencyType.ERC20) {</span>
<span class="cstat-no" title="statement not covered">            if (from == address(this)) {</span>
<span class="cstat-no" title="statement not covered">                return IERC20(cur.location).transfer(to, amountOrId);</span>
            } else {
<span class="cstat-no" title="statement not covered">                return IERC20(cur.location).transferFrom(from, to, amountOrId);</span>
            }
        } else <span class="cstat-no" title="statement not covered">if (cur.currencyType == CurrencyType.ERC721) {</span>
<span class="cstat-no" title="statement not covered">            IERC721(cur.location).safeTransferFrom(from, to, amountOrId, "")</span>;
        } else <span class="cstat-no" title="statement not covered">if (cur.currencyType == CurrencyType.ERC1155Token) {</span>
<span class="cstat-no" title="statement not covered">            if (cur.ERC1155Id == 0) <span class="cstat-no" title="statement not covered">cur.ERC1155Id = uint256(cur.ERC1155SmallId)</span>;</span>
<span class="cstat-no" title="statement not covered">            IERC1155(cur.location).safeTransferFrom(</span>
                from,
                to,
                cur.ERC1155Id,
                amountOrId,
                data
            );
        } else <span class="cstat-no" title="statement not covered">if (cur.currencyType == CurrencyType.ERC1155NFT) {</span>
<span class="cstat-no" title="statement not covered">            IERC1155(cur.location).safeTransferFrom(</span>
                from,
                to,
                amountOrId,
                1,
                data
            );
        }
<span class="cstat-no" title="statement not covered">        return true;</span>
    }
&nbsp;
    /**
     * @dev Internal method to append a new currency efficiently.
     * @param c pre-build Currency structure to be added.
     */
<span class="fstat-no" title="function not covered">    function _addCurrency(Currency memory c) internal {</span>
<span class="cstat-no" title="statement not covered">        currencies.push(c)</span>;
<span class="cstat-no" title="statement not covered">        uint256 id = 0;</span>
<span class="cstat-no" title="statement not covered">        if (c.currencyType == CurrencyType.ERC1155Token) {</span>
<span class="cstat-no" title="statement not covered">            id = c.ERC1155SmallId</span>;
<span class="cstat-no" title="statement not covered">            if (c.ERC1155Id != 0) <span class="cstat-no" title="statement not covered">id = c.ERC1155Id</span>;</span>
        }
<span class="cstat-no" title="statement not covered">        emit CurrencyAdded(</span>
            currencies.length - 1,
            c.currencyType,
            c.location,
            id
        );
    }
}
&nbsp;</pre></td></tr>
</tbody></table></pre>
<div class="push"></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class="footer quiet pad2 space-top1 center small">
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jul 15 2022 16:09:45 GMT+0000 (Coordinated Universal Time)
</div>

<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>


</body></html>